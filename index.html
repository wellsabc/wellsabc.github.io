<!DOCTYPE html>
<html>
<head>
    <title>خريطة Leaflet - فلترة الينابيع حسب المنطقة</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #map { height: 90vh; width: 100vw; }
        #controls {
            padding: 10px;
            background: #f9f9f9;
        }
    </style>
</head>
<body>

<div id="controls">
    <label for="zoneSelect">اختر المنطقة:</label>
    <select id="zoneSelect">
        <option value="all">كل المناطق</option>
        <option value="A">المنطقة أ</option>
        <option value="B">المنطقة ب</option>
        <option value="C">المنطقة ج</option>
    </select>
</div>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    const map = L.map('map').setView([32.0, 35.0], 10);

    // طبقة الأساس
    const baseLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors',
        maxZoom: 19
    }).addTo(map);

    // كائن لحفظ طبقات التحكم
    const overlays = {};
    const baseMaps = { "خريطة الأساس": baseLayer };

    let abcLayer;
    let wellsLayer;
    let allWellsData = null;

    // تحميل طبقة المناطق ABC.geojson
    fetch('ABC.geojson')
        .then(response => response.json())
        .then(data => {
            abcLayer = L.geoJSON(data, {
                onEachFeature: function(feature, layer) {
                    layer.bindPopup("عنصر من ABC");
                }
            }).addTo(map);

            // أضف طبقة المناطق إلى أدوات التحكم
            overlays["المناطق (ABC)"] = abcLayer;

            map.fitBounds(abcLayer.getBounds());

            // أضف أداة التحكم بالطبقات
            L.control.layers(baseMaps, overlays).addTo(map);
        })
        .catch(err => console.error("فشل في تحميل ABC.geojson:", err));

    // تحميل طبقة الينابيع
    fetch('Wells.json')
        .then(response => response.json())
        .then(data => {
            allWellsData = data;
            displayWells("all"); // عرض كل الينابيع عند البداية
        })
        .catch(err => console.error("فشل في تحميل Wells.json:", err));

    // دالة عرض الينابيع حسب المنطقة
    function displayWells(zone) {
        // إزالة الطبقة القديمة إن وُجدت
        if (wellsLayer) {
            map.removeLayer(wellsLayer);
            delete overlays["الينابيع"];
        }

        // فلترة حسب المنطقة
        const filtered = {
            type: "FeatureCollection",
            features: allWellsData.features.filter(feature => {
                if (zone === "all") return true;
                return feature.properties.zone === zone;
            })
        };

        // إنشاء الطبقة الجديدة
        wellsLayer = L.geoJSON(filtered, {
            onEachFeature: function(feature, layer) {
                const name = feature.properties?.name || "بئر بدون اسم";
                layer.bindPopup("اسم البئر: " + name);
            },
            pointToLayer: function(feature, latlng) {
                return L.circleMarker(latlng, {
                    radius: 6,
                    fillColor: "blue",
                    color: "#000",
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.8
                });
            }
        }).addTo(map);

        // أضف طبقة الينابيع إلى أدوات التحكم
        overlays["الينابيع"] = wellsLayer;

        // إعادة إنشاء أداة التحكم لتحديث العرض
        L.control.layers(baseMaps, overlays).addTo(map);
    }

    // عند تغيير الاختيار من القائمة
    document.getElementById("zoneSelect").addEventListener("change", function() {
        const selectedZone = this.value;
        displayWells(selectedZone);
    });
</script>

</body>
</html>
